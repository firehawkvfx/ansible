
### modify houdini environment vars

- name: houdini_version_item
  debug:
    var: houdini_version_item
  tags:
  - cloud-install
  - onsite-install

- name: ensure houdini.env file is present
  file:
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    owner: deadlineuser
    group: syscontrol
    state: touch
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: firehawk vars in beggining of in houdini.env file.
  blockinfile:
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    insertbefore: BOF
    block: |
      PDGMQ_USE_IP=1
      FIREHAWK_HOUDINI_TOOLS = "{{ firehawk_houdini_tools }}"
      PROD_ROOT = "{{ localnas1_mount_path }}"
      PROD_ONSITE_ROOT = "{{ localnas1_path_abs }}"
      PROD_CLOUD_ROOT = "{{ softnas1_path_abs }}"
    marker: "### {mark} ANSIBLE MANAGED BLOCK HOUDINI{{ houdini_version_item.houdini_major_version }} FIREHAWK VARIABLES ###"
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: set HOUDINI_PATH in houdini.env file.
  lineinfile:
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    state: present
    regexp: '.*HOUDINI_PATH =.*'
    line: 'HOUDINI_PATH = "$HOUDINI_PATH; $FIREHAWK_HOUDINI_TOOLS/scripts/menus; ~/Thinkbox/Deadline10/submitters/HoudiniSubmitter; $FIREHAWK_HOUDINI_TOOLS; &"'
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: set HOUDINI_MENU_PATH in houdini.env.
  lineinfile:
    state: present
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    regexp: '.*HOUDINI_MENU_PATH =.*'
    line: 'HOUDINI_MENU_PATH = "$HOUDINI_MENU_PATH; $FIREHAWK_HOUDINI_TOOLS/scripts/menus; $FIREHAWK_HOUDINI_TOOLS/toolbar; ~/Thinkbox/Deadline10/submitters/HoudiniSubmitter; /home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/scripts/menus;&"'
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: set HOUDINI_MENU_PATH in houdini.env.
  lineinfile:
    state: present
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    regexp: '.*HOUDINI_TOOLBAR_PATH =.*'
    line: 'HOUDINI_TOOLBAR_PATH = "$FIREHAWK_HOUDINI_TOOLS/toolbar; @/toolbar;&"'
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: set HOUDINI_OTLSCAN_PATH in houdini.env.
  lineinfile:
    state: present
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    regexp: '.*HOUDINI_OTLSCAN_PATH.=.*'
    line: 'HOUDINI_OTLSCAN_PATH = "@/otls:$FIREHAWK_HOUDINI_TOOLS/hda:/prod/assets/hda"'
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: set PYTHON path in houdini.env.
  lineinfile:
    state: present
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    regexp: '.*PYTHON =.*'
    line: 'PYTHON = "/opt/hfs{{ houdini_version_item.houdini_major_version }}/python/bin/python"'
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: set PYTHON path in houdini.env.
  lineinfile:
    state: present
    path: "/home/deadlineuser/houdini{{ houdini_version_item.houdini_major_version }}/houdini.env"
    backup: true
    regexp: '^HOUDINI_TEMP_DIR =.*'
    line: 'HOUDINI_TEMP_DIR = "/prod/tmp"'
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: Add alias for houdini
  lineinfile:
    state: present
    path: /home/deadlineuser/.bashrc
    line: "alias h{{ houdini_version_item.houdini_major_version }}='cwd=\"$(pwd)\" && cd /opt/hfs{{ houdini_version_item.houdini_major_version }}/ && source houdini_setup && cd $cwd && houdinifx'"
    backup: true
    owner: deadlineuser
    regexp: ".*alias h{{ houdini_version_item.houdini_major_version }}=.*"
  become: yes
  tags:
  - cloud-install
  - onsite-install

- name: Add alias for hython
  lineinfile:
    state: present
    path: /home/deadlineuser/.bashrc
    line: "alias hy{{ houdini_version_item.houdini_major_version }}='cwd=\"$(pwd)\" && cd /opt/hfs{{ houdini_version_item.houdini_major_version }}/ && source houdini_setup && cd $cwd && hython'"
    backup: true
    owner: deadlineuser
    regexp: ".*alias hy{{ houdini_version_item.houdini_major_version }}=.*"
  become: yes 
  tags:
  - cloud-install
  - onsite-install

- name: Add alias for houdini_setup environment
  lineinfile:
    state: present
    path: /home/deadlineuser/.bashrc
    line: "alias henv{{ houdini_version_item.houdini_major_version }}='cwd=\"$(pwd)\" && cd /opt/hfs{{ houdini_version_item.houdini_major_version }}/ && source houdini_setup && cd $cwd'"
    backup: true
    owner: deadlineuser
    regexp: ".*alias henv{{ houdini_version_item.houdini_major_version }}=.*"
  become: yes 
  tags:
  - cloud-install
  - onsite-install
  
### end modify houdini environment vars
