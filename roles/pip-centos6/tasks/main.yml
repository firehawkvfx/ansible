---
# tasks file for ./ansible/roles/pip-centos5

# - name: install pip
#   package:
#     name: python-pip
#     state: latest

# - name: uninstall urllib3 because of conflict with rhel 8 packages
#   pip:
#     name: urllib3
#     state: absent
#   become: yes

# - name: install python-urllib3 with yum 
#   yum:
#     name: 'python-urllib3'
#     state: present
#   become: yes

# - name: install expect
#   package:
#     name: expect
#     state: present

# - name: install epel-release
#   package:
#     name: epel-release
#     state: present

# - name: install pexpect
#   pip:
#     name: pexpect
#   become: yes
  
# - name: install passlib
#   pip:
#     name: passlib
#   become: yes

# - name: install the package
#   package: 
#     name: python-boto
#   become: true

# - name: install the package
#   pip: 
#     name: boto3
#   become: true


# pulled from older playbook used on open vpn.  no boto.

  ---
# tasks file for roles/init-packages

- name: Collect some facts only for ansible_distribution
  setup:
    gather_subset:
      - '!all'
      - 'min'
  tags:
  - always
  
- name: ansible distro
  debug:
    var: ansible_distribution

- name: fping
  apt:
    name:
    - fping # used to ping with max reytries up to a certain time to test open vpn.
    state: present
    update_cache: yes
  register: install_package
  until: install_package is not failed
  retries: 5
  become: true
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- name: install mkpasswd, pip, pexpect, passlib, fping
  package:
    name:
    - python-pip
    - python-apt
    - python-passlib
    state: present
  become: true

- name: Install requests module to query web pages in (houdini python install script)
  pip:
    name: requests
    executable: pip
  become: true

- name: install pexpect for rhel / centos,
  pip:
    name: pexpect
    executable: pip
  become: true
  when: ansible_distribution == 'CentOS' or ansible_distribution == 'RedHat'

# Enterprise Linux'
# Above is for RHEL and Centos, the following is for Debian/Ubuntu:

- name: Install expect pip for Ubuntu
  pip:
    name: pexpect
    executable: pip
  become: true
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'

- name: install pexpect for ubuntu
  package:
    name:
    # - python-pexpect
    - nfs-common
    state: present
  become: true
  when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'